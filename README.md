# Spring Boot User Management API

## Overview

This project is a Spring Boot application designed to manage user information through a REST API. The application provides endpoints to perform CRUD operations on user data, including creating, reading, updating, and deleting user records. It features exception handling and data validation to ensure robustness and reliability.

## Project Structure

### Controller Layer

- **`UserController`**: Handles HTTP requests and responses for user-related operations.
  - **GET `/api/users/{id}`**: Retrieves a user by ID.
  - **GET `/api/users/all`**: Retrieves all users.
  - **POST `/api/users`**: Creates a new user.
  - **DELETE `/api/users/{id}`**: Deletes a user by ID.
  - **DELETE `/api/users/all`**: Deletes all users.

### Service Layer

- **`UserService`**: Contains business logic for user management.
  - **`findById(Long id)`**: Finds a user by ID, throws `NotFoundException` if not found.
  - **`saveUser(User user)`**: Saves a new user, ensuring no more than a set limit of users share the same email.
  - **`deleteUser(Long id)`**: Deletes a user by ID, returns a boolean indicating success.
  - **`deleteAll()`**: Deletes all users, truncates the user table using raw SQL.
  - **`findAll()`**: Retrieves all users, throws `NotFoundException` if no users exist.

### DAO Layer

- **`UserDAO`**: Defines methods for interacting with the database.
  - **`findById(Long id)`**: Finds a user by ID.
  - **`save(User user)`**: Saves a user.
  - **`delete(User user)`**: Deletes a user.
  - **`findAll()`**: Retrieves all users.
  - **`countEmail(String email)`**: Counts the number of users with a specific email.
  - **`deleteAll(List<User> users)`**: Deletes a list of users.

- **`UserDAOImpl`**: Implements `UserDAO` using `UserRepository`.

### Exception Handling

- **`CustomExceptionHandler`**: Handles exceptions globally.
  - **`handleNotFoundException(NotFoundException ex)`**: Handles `NotFoundException`.
  - **`handleGeneralException(Exception ex)`**: Handles general exceptions.

- **`NotFoundException`**: Custom exception for not found scenarios.

### Repository Layer

- **`UserRepository`**: Extends `JpaRepository` for user entity operations and custom queries.

### Model

- **`User`**: Represents the user entity with fields `id`, `username`, and `email`. Validations are enforced on the `username` and `email` fields.

### Validation and ID Auto-Generation

- **Validation**: 
  - The `User` entity uses Jakarta Bean Validation annotations to enforce data integrity:
    - `@NotNull` ensures that `username` and `email` are not null.
    - `@Size` ensures the `username` length is between 3 and 50 characters.
    - `@Email` ensures that `email` is a valid email address.
  - Validation errors are handled automatically by Spring Boot, and appropriate error responses are generated.

- **ID Auto-Generation**:
  - The `id` field in the `User` entity is annotated with `@GeneratedValue(strategy = GenerationType.IDENTITY)`, which means the ID is auto-generated by the database.
  - This strategy relies on the underlying database to generate a unique ID for each new user record.

## Project Flow

1. **Controller to Service**: The `UserController` receives HTTP requests and delegates the operations to `UserService`.
2. **Service to DAO**: The `UserService` interacts with `UserDAO` to perform database operations.
3. **DAO to Repository**: The `UserDAOImpl` uses `UserRepository` to execute database queries.
4. **Exception Handling**: Any exceptions are caught by `CustomExceptionHandler` to provide appropriate HTTP responses.

## URL Testing with Postman

To test the API endpoints, use Postman to send HTTP requests:

- **GET `/api/users/{id}`**: Retrieves a user by ID.
  - **Example Request**: `GET http://localhost:8080/api/users/1`
- **GET `/api/users/all`**: Retrieves all users.
  - **Example Request**: `GET http://localhost:8080/api/users/all`
- **POST `/api/users`**: Creates a new user.
  - **Example Request**: `POST http://localhost:8080/api/users`
  - **Request Body**:
    ```json
    {
      "username": "Jane Doe",
      "email": "jane.doe@example.com"
    }
    ```
- **DELETE `/api/users/{id}`**: Deletes a user by ID.
  - **Example Request**: `DELETE http://localhost:8080/api/users/1`
- **DELETE `/api/users/all`**: Deletes all users.
  - **Example Request**: `DELETE http://localhost:8080/api/users/all`

## Workflow

1. **Initialize Project**: Set up the Spring Boot application and configure the database connection.
2. **Define Model**: Create the `User` entity class with validation annotations.
3. **Create Repository**: Implement `UserRepository` for database operations.
4. **Implement DAO**: Develop `UserDAO` and its implementation `UserDAOImpl`.
5. **Develop Service Layer**: Implement `UserService` with business logic.
6. **Build Controller**: Create `UserController` to handle HTTP requests.
7. **Exception Handling**: Implement custom exceptions and a global exception handler.
8. **Testing**: Write unit tests for the service layer using JUnit and Mockito.
9. **API Testing**: Verify API endpoints using Postman.

## Problem Statement

The project addresses the need for a user management system where users can be created, retrieved, updated, and deleted. The system must:
- Ensure that no more than a specified limit of users share the same email address.
- Provide meaningful error responses when users are not found or when other exceptions occur.
- Implement CRUD operations efficiently and provide an intuitive API for client applications.

---

Feel free to adjust any details based on your project's specifics or additional requirements.
